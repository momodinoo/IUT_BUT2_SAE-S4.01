<!DOCTYPE html>
<html lang="fr">
<html>

<head>
    <meta charset="utf-8">
    <meta content="*" http-equiv="Access-Control-Allow-Origin"/>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Répondre au sondage</title>

    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    <link href="assets/img/icon.ico" rel="icon">
    <link href="assets/css/index.css" rel="stylesheet">
</head>

<body>

<main class="container">
    <h1>Répondre au sondage</h1>
    <form action="./php/addAliment.php" method="post">
        <h2>Choisissez ce que vous consommez :</h2>

        <fieldset>
            <legend> Vos informations</legend>
            <div class="champ">
                <label for="age">Votre Age</label>
                <select class = "list" id="age" name="age">
                <option disabled selected value="NON_SELECTED_VALUE">
                    Entre 10 et 18 ans
                </option>

                <?php for ($i = 10; $i <= 18; $i++): ?>
                <option value="<?= $i ?>">
                    <?= $i ?>
                </option>
                <?php endfor; ?>
                </select>
            </div>

            <div class="champ">
                <label>Votre niveau d'enseignement</label>
                <input id="college" class = "butt Ens" name="enseignement" type="button" value="Collège">
                <input id="lycee" class = "butt Ens" name="enseignement" type="button" value="Lycée">
            </div>
        </fieldset>

        <fieldset>
            <legend> A quel moment prenez-vous ce repas ?</legend>

            <div class="champ">
                <input id="dej" class = "butt moment" name="moment" type="button" value="Matin">
                <input id="diner" class = "butt moment" name="moment" type="button" value="Soir">
            </div>
            
        </fieldset>

        <fieldset>
            <legend>De quoi se compose t'il ?</legend>

            <div class="champ">
                <label for="typeAliment">Sélectionner un type d'aliments</label>
                <select class="list" id="typeAliment" name="typeAliment">
                <option disabled selected value="NON_SELECTED_VALUE">Choisir un type</option>
                <?php foreach ($types as $value): ?>
                <option value='<?= $value["alim_grp_nom_fr"] ?>'> <?= getAlimentType($value) ?> </option>
                <?php endforeach; ?>
                </select>
            </div>

            <div class="champ">
                <label for="aliment">Sélectionner un aliment</label>
                <select class="list" id="aliment" name="aliment">
                <option disabled selected value="NON_SELECTED_VALUE">Choisir un aliment</option>
                </select>
            </div>
            
            <div class="champ">
                <label for="quantite">Quantité</label>
                <input id="quantite" min="1" max="5" name="quantite" required type="number" value="1">
            </div>
            
        </fieldset>

        <input id="addMeal" type="submit" value="Valider le repas"/>

        <?php if (!empty($errors)) : ?>
        <?php foreach ($errors as $error): ?>
        <div class="errors">
            <?= $error ?> <br/>
        </div>
        <?php endforeach; ?>
        <?php endif; ?>

        <?php if (!empty($success)) : ?>
        <?php foreach ($success as $sus): ?>
        <div class="success">
            <?= $sus ?> <br/>
        </div>
        <?php endforeach; ?>
        <?php endif; ?>

    </form>
</main>
<script>
    const alimentsType = document.getElementById("typeAliment");

    alimentsType.onchange = async () => {
        let value = alimentsType.options[alimentsType.selectedIndex].value;

        if (value === "NON_SELECTED_VALUE") return;

        const formData = new FormData();
        formData.append('type', value);

        const res = await fetch("./php/getAlimentsByType.php", {
            method: "POST",
            body: formData,
        })

        const content = JSON.parse(await res.text())
        const alimentList = document.getElementById("aliment");

        while (alimentList.childElementCount !== 1) {
            alimentList.removeChild(alimentList.lastChild);
        }

        for (let aliment of content) {
            const alimentOption = document.createElement("option");
            alimentOption.value = aliment;
            alimentOption.innerText = aliment;

            alimentList.appendChild(alimentOption);
        }
    }

    window.onload = function() {
        BoutonsEns = document.getElementsByClassName('Ens');
        BoutonsMoment = document.getElementsByClassName('moment');
        for(i=0; i<BoutonsEns.length;i++){
            BoutonsEns[i].onclick = function() {
                clickButtEns(this);
            }
        }
        for(i=0; i<BoutonsMoment.length;i++){
            BoutonsMoment[i].onclick = function() {
                clickButtMoment(this);
            }
        }
    }

    function clickButtEns(butt) {
        butt.classList.toggle('selectionne');
        for(i=0; i<BoutonsEns.length;i++){
            if(BoutonsEns[i] != butt){
                BoutonsEns[i].classList.remove('selectionne');
            }
        }
    }

    function clickButtMoment(butt) {
        butt.classList.toggle('selectionne');
        for(i=0; i<BoutonsMoment.length;i++){
            if(BoutonsMoment[i] != butt){
                BoutonsMoment[i].classList.remove('selectionne');
            }
        }
    }

</script>

</body>
</html>